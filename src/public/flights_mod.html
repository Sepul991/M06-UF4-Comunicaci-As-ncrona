<!DOCTYPE html>
<!-- saved from url=(0071)# -->
<html lang="en" data-lt-installed="true">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- <style class="darkreader darkreader--text" media="screen"></style>
    <style class="darkreader darkreader--invert" media="screen"></style>
    <style class="darkreader darkreader--inline" media="screen">
        [data-darkreader-inline-bgcolor] {
            background-color: var(--darkreader-inline-bgcolor) !important;
        }

        [data-darkreader-inline-bgimage] {
            background-image: var(--darkreader-inline-bgimage) !important;
        }

        [data-darkreader-inline-border] {
            border-color: var(--darkreader-inline-border) !important;
        }

        [data-darkreader-inline-border-bottom] {
            border-bottom-color: var(--darkreader-inline-border-bottom) !important;
        }

        [data-darkreader-inline-border-left] {
            border-left-color: var(--darkreader-inline-border-left) !important;
        }

        [data-darkreader-inline-border-right] {
            border-right-color: var(--darkreader-inline-border-right) !important;
        }

        [data-darkreader-inline-border-top] {
            border-top-color: var(--darkreader-inline-border-top) !important;
        }

        [data-darkreader-inline-boxshadow] {
            box-shadow: var(--darkreader-inline-boxshadow) !important;
        }

        [data-darkreader-inline-color] {
            color: var(--darkreader-inline-color) !important;
        }

        [data-darkreader-inline-fill] {
            fill: var(--darkreader-inline-fill) !important;
        }

        [data-darkreader-inline-stroke] {
            stroke: var(--darkreader-inline-stroke) !important;
        }

        [data-darkreader-inline-outline] {
            outline-color: var(--darkreader-inline-outline) !important;
        }

        [data-darkreader-inline-stopcolor] {
            stop-color: var(--darkreader-inline-stopcolor) !important;
        }
    </style>
    <style class="darkreader darkreader--variables" media="screen">
        :root {
            --darkreader-neutral-background: #212222;
            --darkreader-neutral-text: #eae3d9;
            --darkreader-selection-background: #165aaa;
            --darkreader-selection-text: #fbf5ec;
        }
    </style>
    <style class="darkreader darkreader--root-vars" media="screen"></style> -->

    <title>aVolar</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="description"
        content="Flash Able Bootstrap admin template made using Bootstrap 4 and it has huge amount of ready made feature, UI components, pages which completely fulfills any dashboard needs."> -->
    <!-- <meta name="keywords"
        content="admin templates, bootstrap admin templates, bootstrap 4, dashboard, dashboard templets, sass admin templets, html admin templates, responsive, bootstrap admin templates free download,premium bootstrap admin templates, Flash Able, Flash Able bootstrap admin template"> -->
    <!-- <meta name="author" content="Codedthemes"> -->

    <!-- Favicon icon -->
    <!-- <link rel="icon" href="https://lite.codedthemes.com/flash-able-html/assets/images/favicon.ico" type="image/x-icon"> -->
    <!-- fontawesome icon -->
    <!-- <link rel="stylesheet" href="./template_files/fontawesome-all.min.css"> -->
    <!-- <script src="https://kit.fontawesome.com/abe264cf93.js" crossorigin="anonymous"></script> -->
    <!-- animation css -->
    <!-- <link rel="stylesheet" href="./template_files/animate.min.css"> -->

    <!-- vendor css -->
    <link rel="stylesheet" href="./template_files/style.css">

    <link rel="stylesheet" href="./template_files/bootstrap.min.css">

    <!-- choose one -->
    <!-- <script src="https://unpkg.com/feather-icons"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <style>
        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-Light.otf');
            font-weight: 300;
            font-display: swap;
        }

        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-Regular.otf');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-Medium.otf');
            font-weight: 500;
            font-display: swap;
        }

        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-SemiBold.otf');
            font-weight: 600;
            font-display: swap;
        }

        .correct {
            outline: none;
            text-shadow: 0px 0px 2px green;
        }

        .incorrect {
            outline: none;
            text-shadow: 0px 0px 2px red;
        }
    </style>
    <!-- <style class="darkreader darkreader--override" media="screen"></style> -->
</head>

<body class="" monica-locale="es">
    <!-- [ Pre-loader ] start -->

    <!-- [ Pre-loader ] End -->
    <!-- [ navigation menu ] start -->
    <nav class="pcoded-navbar menupos-fixed menu-light brand-blue">
        <div class="navbar-wrapper ">
            <div class="navbar-brand header-logo">
                <a href="#" class="b-brand">
                    <img src="./template_files/logo.svg" alt="" class="logo images">
                    <img src="./template_files/logo-icon.svg" alt="" class="logo-thumb images">
                </a>
                <a class="mobile-menu" id="mobile-collapse" href="#"><span></span></a>
            </div>
            <div class="navbar-content scroll-div ps ps--active-y">
                <ul class="nav pcoded-inner-navbar">
                    <li class="nav-item pcoded-menu-caption">
                        <label>Navegación</label>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="pcoded-micon">
                                <i data-feather="home"></i>
                            </span>
                            <span class="pcoded-mtext">Dashboard</span></a>
                    </li>
                    <li class="nav-item pcoded-menu-caption">
                        <label>Tablas</label>
                    </li>
                    <li class="nav-item">
                        <a href="/flights.html" class="nav-link">
                            <span class="pcoded-micon">
                                <i data-feather="send"></i>
                            </span>
                            <span class="pcoded-mtext">Vuelos</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="pcoded-micon">
                                <i data-feather="align-justify"></i>
                            </span>
                            <span class="pcoded-mtext">Bootstraptable</span>
                        </a>
                    </li>
                    <li class="nav-item pcoded-menu-caption">
                        <label>Modificaciones</label>
                    </li>
                    <li class="nav-item active">
                        <a href="/flights_mod.html" class="nav-link">
                            <span class="pcoded-micon">
                                <i data-feather="edit"></i>
                            </span>
                            <span class="pcoded-mtext">Vuelos</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- [ navigation menu ] end -->

    <!-- [ Header ] start -->
    <header class="navbar pcoded-header navbar-expand-lg navbar-light headerpos-fixed">
        <div class="collapse navbar-collapse">
            <a href="#" class="mob-toggler"></a>
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <div class="main-search open">
                        <div class="input-group">
                            <input type="text" id="m-search" class="form-control" placeholder="Search . . .">
                            <a href="#" class="input-group-append search-close">
                                <i data-feather="x"></i>
                            </a>
                            <span class="input-group-append search-btn btn btn-primary">
                                <i data-feather="search"></i>
                            </span>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </header>
    <!-- [ Header ] end -->
    <!-- [ Main Content ] start -->
    <section class="pcoded-main-container">
        <div class="pcoded-wrapper">
            <div class="pcoded-content">
                <div class="pcoded-inner-content">
                    <div class="main-body">
                        <div class="page-wrapper">
                            <!-- [ Main Content ] start -->
                            <div class="row">

                                <!-- Afegir -->
                                <div class="col-12">
                                    <h1 class="px-2">Añadir</h1>

                                    <div class="">
                                        <div class="table-responsive">
                                            <form id="flightCreateForm">
                                                <div class="d-flex">
                                                    <div class="form-group col-4">
                                                        <label for="plane">Avión *</label>
                                                        <select name="aircraft_code" id="plane"
                                                            class="form-control col-12 plane" required>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label for="flight_no">Numero de vuelo *</label>
                                                        <input type="text" id="flight_no" class="form-control"
                                                            name="flight_no" placeholder="Ex. AB1234" required
                                                            maxlength="6" minlength="6">
                                                        <small>Debe contener 6 caracteres</small>
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label for="status">Status *</label>
                                                        <select name="status" id="status" class="form-control col-12">
                                                            <option value="Departed">Despegó</option>
                                                            <option value="Arrived">Ha llegado</option>
                                                            <option value="On Time">A tiempo</option>
                                                            <option value="Cancelled">Cancelado</option>
                                                            <option value="Delayed">Retraso</option>
                                                            <option value="Scheduled">Programado</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="d-flex">
                                                    <div class="form-group col-4">
                                                        <label for="departure_airport">Aeropuerto de Salida *</label>
                                                        <select name="departure_airport" id="departure_airport"
                                                            class="form-control airport">
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label for="scheduled_departure">Salida Programada *</label>
                                                        <input type="datetime-local" id="scheduled_departure"
                                                            class="form-control" name="scheduled_departure" required>
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label for="actual_departure">Salida Real</label>
                                                        <input type="datetime-local" id="actual_departure"
                                                            class="form-control" name="actual_departure">
                                                    </div>
                                                </div>
                                                <div class="d-flex">
                                                    <div class="form-group col-4">
                                                        <label for="arrival_airport">Aeropuerto de Llegada *</label>
                                                        <select name="arrival_airport" id="arrival_airport"
                                                            class="form-control airport">
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label for="scheduled_arrival">Llegada Programada *</label>
                                                        <input type="datetime-local" id="scheduled_arrival"
                                                            class="form-control" name="scheduled_arrival" required>
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label for="actual_arrival">Llegada Real</label>
                                                        <input type="datetime-local" id="actual_arrival"
                                                            class="form-control" name="actual_arrival">
                                                    </div>
                                                </div>
                                                <div class="col-12 d-flex justify-content-center">
                                                    <button type="submit" class="py-2 px-3 btn btn-dark">Añadir
                                                        Vuelo</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <script>

                                    // POST de vol
                                    document.addEventListener('DOMContentLoaded', function () {
                                        const form = document.getElementById('flightCreateForm');

                                        form.addEventListener('submit', function (event) {
                                            event.preventDefault();

                                            const formData = new FormData(form);
                                            const formDataObject = Object.fromEntries(formData.entries());
                                            // console.log(formDataObject)

                                            let f_sch_departure = document.getElementById("scheduled_departure").value
                                            let f_sch_arrival = document.getElementById("scheduled_arrival").value
                                            let f_real_departure = document.getElementById("actual_departure").value
                                            let f_real_arrival = document.getElementById("actual_arrival").value
                                            console.log(f_sch_departure, f_sch_arrival, f_sch_departure <= f_sch_arrival)

                                            // Funciona
                                            if (f_sch_departure >= f_sch_arrival) {
                                                alert("La fecha de llegada tiene que ser posterior a la de salida.");
                                                return;
                                            }

                                            if (f_real_departure != "") {
                                                if (f_real_departure >= f_sch_arrival) {
                                                    alert("La fecha de llegada tiene que ser posterior a la de salida programada.");
                                                    return;
                                                }
                                            }

                                            if (f_real_departure != "" && f_real_arrival != "") {
                                                if (f_real_departure >= f_real_arrival) {
                                                    alert("La fecha programada de llegada tiene que ser posterior a la de salida programada.");
                                                    return;
                                                }
                                            }


                                            fetch('/flight', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify(formDataObject)
                                            })
                                                .then(response => {
                                                    console.log('Status code de la respuesta:', response.status);

                                                    if (!response.ok) {
                                                        response.json().then(errorData => {
                                                            // if (errorData.message.includes("flights_check")) {
                                                            //     alert("La fecha de llegada tiene que ser posterior a la de salida.");
                                                            // }
                                                            alert(errorData.message);
                                                        });
                                                        throw new Error('Error en la respuesta de la red.');
                                                    } else {
                                                        console.log("Recurso creado con éxito.")
                                                        alert("Vuelo añadido correctamente.")
                                                        form.reset();
                                                    }
                                                })
                                                .catch(error => {
                                                    console.error('Error al enviar los datos del formulario:', error);
                                                });
                                        });
                                    });

                                    // Carrega els avions
                                    fetch('/aircraft')
                                        .then(response => response.json())
                                        .then(data => {
                                            const planeSelect = document.getElementsByClassName('plane');

                                            for (let i = 0; i < planeSelect.length; i++) {
                                                data.aircrafts.forEach(aircraft => {
                                                    const option = document.createElement('option');
                                                    option.value = aircraft.aircraft_code;
                                                    option.innerHTML = `
                                                            ${aircraft.model} (${aircraft.range} km)
                                                        `;
                                                    planeSelect[i].appendChild(option);
                                                });
                                            }

                                        })
                                        .catch(error => {
                                            console.error('Error fetching flights:', error);
                                        });

                                    // Carrega els aeroports
                                    fetch('/airport')
                                        .then(response => response.json())
                                        .then(data => {
                                            const airportSelect = document.getElementsByClassName('airport');

                                            for (const elem of airportSelect) {
                                                data.airports.forEach(airport => {
                                                    const option = document.createElement('option');
                                                    option.value = airport.airport_code;
                                                    option.innerHTML = `
                                                            ${airport.airport_name} (${airport.city} km)
                                                        `;
                                                    elem.appendChild(option);
                                                });
                                            }

                                        })
                                        .catch(error => {
                                            console.error('Error fetching flights:', error);
                                        });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Required Js -->
    <!-- <script src="./template_files/vendor-all.min.js.descarga"></script> -->
    <!-- <script src="./template_files/bootstrap.min.js.descarga"></script> -->
    <!-- <script src="./template_files/pcoded.min.js.descarga"></script> -->


    <script>
        feather.replace();
    </script>
</body>

</html>