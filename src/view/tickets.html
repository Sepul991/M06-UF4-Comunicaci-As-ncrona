<!DOCTYPE html>
<!-- saved from url=(0071)https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html -->
<html lang="en" data-lt-installed="true">

<head>
    <script src="../src/styles/scrollCss.css"></script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../public/scrollCss.css">


    <title>Flash Able - Bootstrap Basic Tables</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description"
        content="Flash Able Bootstrap admin template made using Bootstrap 4 and it has huge amount of ready made feature, UI components, pages which completely fulfills any dashboard needs.">
    <meta name="keywords"
        content="admin templates, bootstrap admin templates, bootstrap 4, dashboard, dashboard templets, sass admin templets, html admin templates, responsive, bootstrap admin templates free download,premium bootstrap admin templates, Flash Able, Flash Able bootstrap admin template">
    <meta name="author" content="Codedthemes">

    <!-- Favicon icon -->
    <link rel="icon" href="https://lite.codedthemes.com/flash-able-html/assets/images/favicon.ico" type="image/x-icon">
    <!-- fontawesome icon -->
    <link rel="stylesheet" href="./template_files/fontawesome-all.min.css">
    <!-- animation css -->
    <link rel="stylesheet" href="./template_files/animate.min.css">

    <!-- vendor css -->
    <link rel="stylesheet" href="./template_files/style.css">

    <link rel="stylesheet" href="./template_files/bootstrap.min.css">

    <style>
        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-Light.otf');
            font-weight: 300;
            font-display: swap;
        }

        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-Regular.otf');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-Medium.otf');
            font-weight: 500;
            font-display: swap;
        }

        @font-face {
            font-family: 'monica-ext-font_YIBBBFG';
            src: url('chrome-extension://ofpnmcalabcbjgholdjcjblkibolbppb/static/fonts/Hind-SemiBold.otf');
            font-weight: 600;
            font-display: swap;
        }

        /* tabla reservas */
        #tb {
            border: rgb(228, 226, 226) solid 1px;
            overflow: scroll;
            height: 50vh;
        }

        #tt {
            border: rgb(228, 226, 226) solid 1px;
            overflow: scroll;
            height: 50vh;
        }

        .editBook {
            display: none;
        }

        .editTickets {

            display: none;
        }
    </style>


</head>

<body>
    <!-- [ Pre-loader ] start -->

    <!-- [ Pre-loader ] End -->
    <!-- [ navigation menu ] start -->
    <nav class="pcoded-navbar menupos-fixed menu-light brand-blue">
        <div class="navbar-wrapper ">
            <div class="navbar-brand header-logo">
                <a href="#" class="b-brand">
                    <img src="./template_files/logo.svg" alt="" class="logo images">
                    <img src="./template_files/logo-icon.svg" alt="" class="logo-thumb images">
                </a>
                <a class="mobile-menu" id="mobile-collapse" href="#"><span></span></a>
            </div>
            <div class="navbar-content scroll-div ps ps--active-y">
                <ul class="nav pcoded-inner-navbar">
                    <li class="nav-item pcoded-menu-caption">
                        <label>Navigation</label>
                    </li>
                    <li class="nav-item">
                        <a href="/index.html" class="nav-link"><span class="pcoded-micon"><i
                                    class="feather icon-home"></i></span><span class="pcoded-mtext">Dashboard</span></a>
                    </li>


                    <li class="nav-item pcoded-menu-caption">
                        <label>Forms &amp; table</label>
                    </li>
                    <li class="nav-item active">
                        <a href="#" class="nav-link"><span class="pcoded-micon"><i
                                    class="feather icon-align-justify"></i></span><span class="pcoded-mtext">Tickets
                            </span></a>
                    </li>
                </ul>

                <div class="ps__rail-x" style="left: 0px; bottom: 0px;">
                    <div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div>
                </div>
                <div class="ps__rail-y" style="top: 0px; height: 717px; right: 0px;">
                    <div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 527px;"></div>
                </div>
            </div>
        </div>
    </nav>
    <!-- [ navigation menu ] end -->

    <!-- [ Header ] start -->
    <header class="navbar pcoded-header navbar-expand-lg navbar-light headerpos-fixed">
        <div class="m-header">
            <a class="mobile-menu" id="mobile-collapse1"
                href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!"><span></span></a>
            <a href="https://lite.codedthemes.com/flash-able-html/default/index.html" class="b-brand">
                <img src="./template_files/logo.svg" alt="" class="logo images">
                <img src="./template_files/logo-icon.svg" alt="" class="logo-thumb images">
            </a>
        </div>
        <a class="mobile-menu" id="mobile-header"
            href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!">
            <i class="feather icon-more-horizontal"></i>
        </a>
        <div class="collapse navbar-collapse">
            <a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!" class="mob-toggler"></a>
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <div class="main-search open">
                        <div class="input-group">
                            <input type="text" id="m-search" class="form-control" placeholder="Search . . .">
                            <a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!"
                                class="input-group-append search-close">
                                <i class="feather icon-x input-group-text"></i>
                            </a>
                            <span class="input-group-append search-btn btn btn-primary">
                                <i class="feather icon-search input-group-text"></i>
                            </span>
                        </div>
                    </div>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li>
                    <div class="dropdown">
                        <a class="dropdown-toggle"
                            href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#"
                            data-toggle="dropdown"><i class="icon feather icon-bell"></i></a>
                        <div class="dropdown-menu dropdown-menu-right notification">
                            <div class="noti-head">
                                <h6 class="d-inline-block m-b-0">Notifications</h6>
                                <div class="float-right">
                                    <a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!"
                                        class="m-r-10">mark as read</a>
                                    <a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!">clear
                                        all</a>
                                </div>
                            </div>
                            <ul class="noti-body ps">
                                <li class="n-title">
                                    <p class="m-b-0">NEW</p>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius" src="./template_files/avatar-1.jpg"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>John Doe</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>5 min</span></p>
                                            <p>New ticket Added</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="n-title">
                                    <p class="m-b-0">EARLIER</p>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius" src="./template_files/avatar-2.jpg"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Joseph William</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>10 min</span></p>
                                            <p>Prchace New Theme and make payment</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius" src="./template_files/avatar-3.jpg"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Sara Soudein</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>12 min</span></p>
                                            <p>currently login</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius" src="./template_files/avatar-1.jpg"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Joseph William</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>30 min</span></p>
                                            <p>Prchace New Theme and make payment</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius" src="./template_files/avatar-3.jpg"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Sara Soudein</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>1 hour</span></p>
                                            <p>currently login</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius" src="./template_files/avatar-1.jpg"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Joseph William</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>2 hour</span></p>
                                            <p>Prchace New Theme and make payment</p>
                                        </div>
                                    </div>
                                </li>
                                <div class="ps__rail-x" style="left: 0px; bottom: 0px;">
                                    <div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div>
                                </div>
                                <div class="ps__rail-y" style="top: 0px; right: 0px;">
                                    <div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 0px;"></div>
                                </div>
                            </ul>
                            <div class="noti-footer">
                                <a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!">show
                                    all</a>
                            </div>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="dropdown drp-user">
                        <a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#"
                            class="dropdown-toggle" data-toggle="dropdown">
                            <i class="icon feather icon-settings"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right profile-notification">
                            <div class="pro-head">
                                <img src="./template_files/avatar-1.jpg" class="img-radius" alt="User-Profile-Image">
                                <span>John Doe</span>
                                <a href="https://lite.codedthemes.com/flash-able-html/default/auth-signin.html"
                                    class="dud-logout" title="Logout">
                                    <i class="feather icon-log-out"></i>
                                </a>
                            </div>
                            <ul class="pro-body">
                                <li><a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!"
                                        class="dropdown-item"><i class="feather icon-settings"></i> Settings</a></li>
                                <li><a href="https://lite.codedthemes.com/flash-able-html/default/tbl_bootstrap.html#!"
                                        class="dropdown-item"><i class="feather icon-user"></i> Profile</a></li>
                                <li><a href="https://lite.codedthemes.com/flash-able-html/default/message.html"
                                        class="dropdown-item"><i class="feather icon-mail"></i> My Messages</a></li>
                                <li><a href="https://lite.codedthemes.com/flash-able-html/default/auth-signin.html"
                                        class="dropdown-item"><i class="feather icon-lock"></i> Lock Screen</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </header>
    <!-- [ Header ] end -->
    <!-- [ Main Content ] start -->
    <section class="pcoded-main-container">
        <div class="pcoded-wrapper">
            <div class="pcoded-content">
                <div class="pcoded-inner-content">
                    <div class="main-body">
                        <div class="page-wrapper">
                            <!-- [ breadcrumb ] start -->
                            <div class="page-header">
                                <div class="page-block">
                                    <div class="row align-items-center">
                                        <div class="col-md-12">
                                            <div class="page-header-title">
                                                <h5 class="m-b-10">Información Principal de los tickets</h5>
                                            </div>
                                            <ul class="breadcrumb">
                                                <li class="breadcrumb-item"><a href="#"><i
                                                            class="feather icon-home"></i></a></li>
                                                <li class="breadcrumb-item"><a href="#">Bootstrap
                                                        Table</a></li>
                                                <li class="breadcrumb-item"><a href="#">Basic
                                                        Tables</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">

                                <div style="display: flex;justify-content: center; align-content: center; width: 100%;">
                                    <!-- //////////////////////////////////////////////////////////////////////////////////////////// -->
                                    <!-- CREATE NEW BOOKING -->
                                    <div style="width: 100%; display: flex; justify-content: center;">
                                        <div class="card text-center">
                                            <div class="card-header">
                                                CRUD
                                            </div>
                                            <div class="card-body">
                                                <h5 class="card-title">Añadir nueva reserva</h5>
                                                <!-- <p class="card-text">Pestaña para crear un nuevo ticket</p> -->
                                                <a href="/newBooking" class="btn btn-primary">Añadir</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="pepe">

                                    </div>
                                    <!-- //////////////////////////////////////////////////////////////////////////////////////////// -->
                                    <!-- //////////////////////////////////////////////////////////////////////////////////////////// -->
                                    <!-- CREATE NEW BOOKING -->
                                    <div style="width: 100%; display: flex; justify-content: center;">
                                        <div class="card text-center">
                                            <div class="card-header">
                                                CRUD
                                            </div>
                                            <div class="card-body">
                                                <h5 class="card-title">Añadir Ticket a la Reserva</h5>
                                                <p class="card-text">SIN RESERVA NO SE PUEDE AÑADIR TICKETS</p>
                                                <a href="/newTicket" class="btn btn-primary">Añadir</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- //////////////////////////////////////////////////////////////////////////////////////////// -->
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>RESERVAS PROGRAMADAS</h5>
                                            <span class="d-block m-t-5">RESERVAS

                                        </div>
                                        <!-- //////////////////////////////////////////////////////////////////////////////////////////// -->
                                        <div>
                                            <div>
                                                <div>
                                                    <label for="buscarReserva">Buscar Reserva:</label>
                                                    <input type="text" id="buscarReserva" list="sugerencias">
                                                    <datalist id="sugerencias"></datalist>
                                                </div>
                                                <div class="card-body table-border-style">
                                                    <div class="table-responsive">
                                                        <table class="table booking-table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Referencia de la reserva</th>
                                                                    <th>Fecha de la reserva</th>
                                                                    <th>Total de la reserva</th>
                                                                    <th>EDITAR</th>
                                                                    <th>ELIMINAR</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="tablaReservas">
                                                                <!-- Aquí se mostrarán los datos de la reserva seleccionada -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <script>
                                                    function buscarReservas() {
                                                        const inputReserva = document.getElementById('buscarReserva');
                                                        const tablaReservas = document.getElementById('tablaReservas');

                                                        fetch('/booking')
                                                            .then(resp => resp.json())
                                                            .then(data => {
                                                                const reservas = data;
                                                                inputReserva.addEventListener('input', function () {
                                                                    const valorInput = inputReserva.value.trim(); // Obtener el valor del input sin espacios en blanco al principio y al final
                                                                    if (valorInput === '') {
                                                                        // Si el valor del input está vacío, limpiar las sugerencias y no mostrar ninguna
                                                                        mostrarSugerencias([]);
                                                                    } else {
                                                                        // Si hay un valor en el input, filtrar y mostrar las sugerencias
                                                                        const sugerencias = reservas.filter(reserva => reserva.book_ref.includes(valorInput));
                                                                        mostrarSugerencias(sugerencias);
                                                                    }
                                                                });
                                                            })
                                                            .catch(err => {
                                                                console.log('Errores al obtener las reservas', err);
                                                            });
                                                    }

                                                    function mostrarSugerencias(sugerencias) {
                                                        const datalist = document.getElementById('sugerencias');
                                                        datalist.innerHTML = ''; // Limpiar las sugerencias anteriores

                                                        if (sugerencias.length > 0) {
                                                            // Si hay sugerencias, mostrarlas en el datalist
                                                            sugerencias.forEach(sugerencia => {
                                                                const option = document.createElement('option');
                                                                option.value = sugerencia.book_ref;
                                                                datalist.appendChild(option);
                                                            });
                                                        }

                                                        // Mostrar los datos de la reserva seleccionada
                                                        mostrarReservaSeleccionada(sugerencias[0]); // Muestra la primera sugerencia por defecto
                                                    }

                                                    function mostrarReservaSeleccionada(reserva) {
                                                        const tablaReservas = document.getElementById('tablaReservas');
                                                        tablaReservas.innerHTML = ''; // Limpiar la tabla antes de agregar los nuevos datos

                                                        if (reserva) {
                                                            const row = document.createElement('tr');
                                                            row.innerHTML = `
                                                        <td>${reserva.book_ref}</td>
                                                        <td>${reserva.book_date}</td>
                                                        <td>${reserva.total_amount}</td>
                                                        <td><button class="btn btn-warning btn-sm">EDITAR</button></td>
                                                        <td><button class="btn btn-danger btn-sm">ELIMINAR</button></td>
                                                    `;
                                                            tablaReservas.appendChild(row);
                                                        }
                                                    }

                                                    buscarReservas();
                                                </script>

                                                <!-- //////////////////////////////////////////////////////////////////////////////////////////// -->
                                                <!-- RESERVAS -->
                                                <div class="card-body table-border-style">
                                                    <div class="table-responsive" id="tb">
                                                        <table class="table booking-table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Referencia de la reserva</th>
                                                                    <th>Fecha de la reserva</th>
                                                                    <th>Total de la reserva</th>
                                                                    <th>EDITAR</th>
                                                                    <th>ELIMINAR</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="infoBooking">
                                                                <!--  -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- EDITAR RESERVAS -->
                                        <div id="editBooking" class="editBook" style="  position: fixed;
                                                        top: 0;
                                                        left: 0;
                                                        width: 100%;
                                                        height: 100%;
                                                        background-color: rgba(0, 0, 0, 0.5); 
                                                        z-index: 999999; 
                                                        
                                                        
                                                        ">
                                            <div style="  background-color: white;padding: 
                                            20px;
                                            border-radius: 5px;
                                            width: 30vw;
                                            height: auto;
                                            z-index: 1000000;
                                            position: relative;
                                            top: 15%;
                                            left: 40%;">
                                                <div class="form-outline mb-4">
                                                    <label class="form-label" for="oldDateBook">Fecha actual
                                                        reserva</label>
                                                    <input type="date(" format"timestamp)" id="oldDateBook"
                                                        name="oldDateBook" class="form-control form-control-lg"
                                                        readonly />
                                                </div>
                                                <form action=" /editBooking" method="post" id="formBook">
                                                    <div class=" form-outline mb-4">
                                                        <label for="nReserva" class="form-label">nº reserva</label>
                                                        <input name="nReserva" type="text" id="nReserva"
                                                            class="form-control form-control-lg" readonly />
                                                    </div>

                                                    <div class="form-outline mb-4">
                                                        <label class="form-label" for="dateBook">Fecha nueva
                                                            reserva</label>
                                                        <input type="date" id="dateBook" name="dateBook"
                                                            class="form-control form-control-lg" />
                                                    </div>

                                                    <div class="form-outline mb-4">
                                                        <label class="form-label" for="totalAmount">Precio total</label>
                                                        <input type="text" id="totalAmount" name="totalAmount"
                                                            class="form-control form-control-lg" />
                                                    </div>

                                                    <div class="d-flex justify-content-center">
                                                        <button type="submit"
                                                            class="btn btn-success btn-block btn-lg gradient-custom-4 text-body">Modificar</button>
                                                    </div>

                                                    <div class="d-flex justify-content-center">
                                                        <button id="backButton" type="button"
                                                            class="btn btn-primary btn-block btn-lg gradient-custom-4 text-body"
                                                            style="width:10vw ;">Atras</button>
                                                    </div>

                                                </form>
                                            </div>
                                        </div>
                                        <script>
                                            // todo: implement Mirar porque no se acet
                                            document.querySelector('#formBook').addEventListener('submit', function (event) {
                                                event.preventDefault();
                                                // Obtén los datos del formulario
                                                const formData = new FormData(this);

                                                // Realiza la solicitud POST al servidor
                                                fetch("/editBooking", {
                                                    method: "PUT",
                                                    headers: {
                                                        "Content-Type": "application/json",
                                                    },
                                                    body: JSON.stringify(Object.fromEntries(formData)), // Convierte FormData a un objeto JSON
                                                })
                                                    .then(response => {
                                                        if (!response.ok) {
                                                            throw new Error('Error al actualizar el registro' + response.statusText)
                                                        }
                                                        return response.json();
                                                    })
                                                    .then(data => {
                                                        if (data.success) {
                                                            buscarReservas();
                                                            alert("¡Reserva agregada exitosamente!");
                                                        } else {
                                                            // Si la operación falló, muestra el mensaje de error recibido del servidor
                                                            alert(data.message);
                                                        }
                                                    })
                                                    .catch(error => {

                                                        console.error("Error al agregar reserva:", error);
                                                        alert("Error interno del servidor. Por favor, inténtalo de nuevo más tarde.");
                                                    });
                                            });

                                        </script>
                                        <script>

                                            document.getElementById('infoBooking').addEventListener('click', function (e) {
                                                // 
                                                let boxEdit = document.getElementById('editBooking');
                                                if (e.target.tagName == 'BUTTON' && e.target.classList.contains('edit')) {
                                                    if (boxEdit.style.display === 'none' || boxEdit.style.display === '') {
                                                        boxEdit.style.display = 'block'; // Cambia a display:block
                                                    } else {
                                                        boxEdit.style.display = 'none'; // Cambia a display:none
                                                    }
                                                }

                                            });
                                            document.getElementById('backButton').addEventListener('click', function () {
                                                let boxEdit = document.getElementById('editBooking');
                                                boxEdit.style.display = 'none';
                                            });


                                        </script>
                                        <script>
                                            // 
                                            // CARGAR RESERVAS
                                            let moreData = true;
                                            let saltar = 0;


                                            function tableBooking(saltar = 0) {
                                                const tbodyBooking = document.getElementById('infoBooking');
                                                fetch(`/booking?saltar=${saltar}`)
                                                    .then(resp => resp.json())
                                                    .then(data => {
                                                        // tbodyBooking.innerHTML = ''; // Limpiar la tabla antes de agregar los nuevos registros
                                                        data.forEach(infoData => {
                                                            const row = document.createElement('tr');
                                                            row.innerHTML = `
                                                                    <td>${infoData.book_ref}</td>
                                                                    <td>${infoData.book_date}</td>
                                                                    <td>${infoData.total_amount}</td>
                                                                    <td><button class="btn btn-warning btn-sm edit" id="bookEdit" data-booking="${infoData.book_ref}" >Editar
                                                                    </button></td>
                                                                    <td><button class="btn btn-danger btn-sm delete" id="bookDelete" data-booking="${infoData.book_ref}">
                                                                        ELIMINAR
                                                                    </button></td>
                                                                `;
                                                            tbodyBooking.appendChild(row);
                                                        });
                                                        console.log(data);
                                                        moreData = true;
                                                    })
                                                    .catch(err => {
                                                        console.error('Error al obtener las reservas', err);
                                                    });
                                            }
                                            let containerBook = document.getElementById('tb');

                                            containerBook.addEventListener('scroll', function (e) {
                                                // 
                                                // Es una resta
                                                let scroll = containerBook.scrollHeight - containerBook.scrollTop - containerBook.clientHeight;

                                                console.log('Scroll Total', containerBook.scrollHeight, 'Scroll Restante', scroll);

                                                if (scroll <= 200 && moreData) {
                                                    // funcion de vovler a cargar mas datos
                                                    moreData = false;
                                                    saltar += 50;
                                                    console.log(saltar);
                                                    tableBooking(saltar);
                                                }

                                            })
                                            tableBooking();


                                            // document.getElementsByClassName('booking-table').

                                            document.querySelectorAll('.booking-table').forEach(element => {
                                                element.addEventListener('click', function (e) {
                                                    if (e.target.tagName == 'BUTTON' && e.target.classList.contains('delete')) {
                                                        let id = e.target.dataset.booking;
                                                        console.log(id);
                                                        console.log('/delBooking/' + id);
                                                        fetch('/delBooking/' + id, {
                                                            method: 'delete',
                                                        })
                                                            .then(response => {
                                                                if (!response.ok) {
                                                                    throw new Error('Error al borrar la reserva: ' + response.statusText);
                                                                }
                                                                return response.json();
                                                            })
                                                            .then(() => {
                                                                tableBooking(); // Actualizar la tabla después de eliminar el registro
                                                                alert('La reserva ha sido eliminada correctamente.');

                                                            })
                                                            .catch(err => {
                                                                console.error('Error al eliminar reserva', err);
                                                                alert('Hay que eliminar primero el registro de los tickets');

                                                            });
                                                    } if (e.target.tagName === 'BUTTON' && e.target.classList.contains('edit')) {
                                                        let r = document.getElementById('nReserva');
                                                        let d = document.getElementById('oldDateBook');
                                                        let t = document.getElementById('totalAmount');
                                                        console.log(e.target.dataset.booking);
                                                        let id = e.target.dataset.booking;
                                                        fetch('/editBook/' + id)
                                                            .then(resp => resp.json())
                                                            .then(data => {
                                                                // console.log(typeof data);
                                                                // const keys = Object.keys(data);
                                                                // console.log(keys);

                                                                console.log("book_ref: " + data[0].book_ref);
                                                                console.log("book_date: " + data[0].book_date);
                                                                console.log("total_amount: " + data[0].total_amount);

                                                                r.value = data[0].book_ref
                                                                d.value = data[0].book_date
                                                                t.value = data[0].total_amount

                                                            })
                                                            .catch(error => {
                                                                console.error('Error al obtener la información:', error);
                                                            });
                                                    }
                                                });
                                            });

                                            document.getElementById('backButton').addEventListener('click', function (e) {
                                                let boxEdit = document.getElementById('editBooking');
                                                boxEdit.style.display = 'none';
                                            });


                                        </script>
                                        <!-- TICKETS -->
                                        <div class="col-xl-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Información de los billetes</h5>
                                                </div>
                                                <div class="card-body table-border-style">
                                                    <div class="table-responsive" id="tt">
                                                        <table class="table table-striped" id="ticket-tabla">
                                                            <thead>
                                                                <tr>
                                                                    <th>Código de <br>reserva</th>
                                                                    <th>Numero de <br>Ticket</th>
                                                                    <th>Id del <br>pasajero</th>
                                                                    <th>Nombre del <br>pasajero</th>
                                                                    <th>Telefono <br>principal</th>
                                                                    <th>Email<br> pasajero</th>
                                                                    <th>Modificar</th>
                                                                    <th>Eliminar</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="infoTickets">
                                                                <!--  -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- EDITAR RESERVAS -->
                                        <div id="editTickets" class="editTickets" style="  position: fixed;
                                                                                                top: 0;
                                                                                                left: 0;
                                                                                                width: 100%;
                                                                                                height: 100%;
                                                                                                background-color: rgba(0, 0, 0, 0.5); 
                                                                                                z-index: 999999; 
                                                                                               
                                                                                                
                                                                                                ">
                                            <div style="  background-color: white;padding: 
                                                                                    20px;
                                                                                    border-radius: 5px;
                                                                                    width: 30vw;
                                                                                    height: auto;
                                                                                    z-index: 1000000;
                                                                                    position: relative;
                                                                                    top: 5%;
                                                                                    left: 40%;">
                                                <div class="form-outline mb-4">
                                                    <label class="form-label" for="emailPassenger">Email</label>
                                                    <input type="email" id="emailPassenger" name="emailPassenger"
                                                        class="form-control form-control-lg" readonly />
                                                </div>
                                                <form action=" /editTickets" method="post" id="formTicket">
                                                    <div class="form-outline mb-4">
                                                        <label class="form-label" for="nR">Número de
                                                            reserva</label>
                                                        <input type="text" id="nR" name="nR"
                                                            class="form-control form-control-lg" autocomplete="off"
                                                            list="sugerencias" readonly>
                                                        <datalist id="sugerencias"></datalist>
                                                    </div>

                                                    <div class=" form-outline mb-4">
                                                        <label for="nTicket" class="form-label">nº Ticket</label>
                                                        <input name="nTicket" type="number" id="nTicket"
                                                            class="form-control form-control-lg" />
                                                    </div>

                                                    <div class="form-outline mb-4">
                                                        <label class="form-label" for="idPassenger">Id pasajero</label>
                                                        <input type="text" id="idPassenger" name="idPassenger"
                                                            class="form-control form-control-lg" />
                                                    </div>

                                                    <div class="form-outline mb-4">
                                                        <label class="form-label" for="name">Nombre del pasajero</label>
                                                        <input type="text" id="name" name="name"
                                                            class="form-control form-control-lg" />
                                                    </div>



                                                    <div class="d-flex justify-content-center">
                                                        <button type="submit"
                                                            class="btn btn-success btn-block btn-lg gradient-custom-4 text-body">Modificar</button>
                                                    </div>

                                                    <div class="d-flex justify-content-center">
                                                        <button id="backButtont" type="button"
                                                            class="btn btn-primary btn-block btn-lg gradient-custom-4 text-body"
                                                            style="width:10vw ;">Atras</button>
                                                    </div>

                                                </form>
                                            </div>
                                        </div>
                                        <script>
                                            // todo: implement Mirar porque no se acet
                                            document.querySelector('#formTicket').addEventListener('submit', function (event) {
                                                event.preventDefault();
                                                // Obtén los datos del formulario
                                                const formData = new FormData(this);

                                                fetch("/editTickets", {
                                                    method: "PUT",
                                                    headers: {
                                                        "Content-Type": "application/json",
                                                    },
                                                    body: JSON.stringify(Object.fromEntries(formData)), // Convierte FormData a un objeto JSON
                                                })
                                                    .then(response => {
                                                        if (!response.ok) {
                                                            throw new Error('Error al actualizar el registro' + response.statusText)
                                                        }
                                                        return response.json();
                                                    })
                                                    .then(data => {
                                                        if (data.success) {
                                                            buscarReservas();
                                                            alert("¡Reserva agregada exitosamente!");
                                                        } else {
                                                            // Si la operación falló, muestra el mensaje de error recibido del servidor
                                                            alert(data.message);
                                                        }
                                                    })
                                                    .catch(error => {

                                                        console.error("Error al agregar reserva:", error);
                                                        alert("Error interno del servidor. Por favor, inténtalo de nuevo más tarde.");
                                                    });
                                            });

                                        </script>
                                        <script>
                                            // 
                                            document.getElementById('infoTickets').addEventListener('click', function (e) {
                                                // 
                                                let boxEdit = document.getElementById('editTickets');
                                                if (e.target.tagName == 'BUTTON' && e.target.classList.contains('edit')) {
                                                    if (boxEdit.style.display === 'none' || boxEdit.style.display === '') {
                                                        boxEdit.style.display = 'block'; // Cambia a display:block
                                                    } else {
                                                        boxEdit.style.display = 'none'; // Cambia a display:none
                                                    }
                                                }

                                            });
                                            document.getElementById('backButtont').addEventListener('click', function () {
                                                let boxEdit = document.getElementById('editTickets');
                                                boxEdit.style.display = 'none';
                                            });

                                        </script>
                                        <script>
                                            //
                                            document.addEventListener("DOMContentLoaded", function () {
                                                function tablaTicket() {
                                                    const tbody = document.getElementById("infoTickets");
                                                    // tbody.innerHTML = '';

                                                    fetch("/tickets")
                                                        .then((resp) => resp.json())
                                                        .then((data) => {
                                                            tbody.innerHTML = ''; // Limpiar la tabla antes de agregar los nuevos registros
                                                            data.forEach((infoData) => {
                                                                const row = document.createElement("tr");
                                                                row.innerHTML = `
                                                            <td>${infoData.book_ref}</td>
                                                            <td>${infoData.ticket_no}</td>
                                                            <td>${infoData.passenger_id}</td>
                                                            <td >${infoData.passenger_name}</td>
                                                            <td>${infoData.telefono_1}</td>
                                                            <td>${infoData.email}</td>
                                                                    <td><button class="btn btn-warning btn-sm edit" id="ticketEdit" data-ticket="${infoData.ticket_no}" >Editar
                                                                    </button></td>
                                                            <td><button data-ticket="${infoData.ticket_no}" class="btn btn-danger btn-sm delete" id="delete">
                                                            ELIMINAR
                                                            </button></td>
                                                            `;
                                                                tbody.appendChild(row);
                                                            });
                                                            console.log(data);
                                                        })
                                                        .catch((err) => {
                                                            console.error("Error al obtener los tickets", err);
                                                        });
                                                }

                                                tablaTicket();

                                                document.getElementById('ticket-tabla').addEventListener('click', async function (e) {
                                                    if (e.target.tagName == 'BUTTON' && e.target.classList.contains('delete')) {
                                                        let id = e.target.dataset.ticket;
                                                        console.log(id);
                                                        await fetch('/delTicket/' + id, {
                                                            method: 'delete',
                                                        });
                                                        // Después de eliminar el registro, actualiza la tabla con la lista actualizada
                                                        tablaTicket(); // Llama nuevamente a la función que carga la tabla para actualizarla
                                                    } if (e.target.tagName === 'BUTTON' && e.target.classList.contains('edit')) {
                                                        let n = document.getElementById('nR')
                                                        let nt = document.getElementById('nTicket')
                                                        let idP = document.getElementById('idPassenger')
                                                        let nm = document.getElementById('name')
                                                        let emP = document.getElementById('emailPassenger')

                                                        let id = e.target.dataset.ticket;
                                                        console.log(id);

                                                        fetch('/editTicket/' + id)
                                                            .then((resp) => resp.json())
                                                            .then((data) => {
                                                                // 
                                                                let primeraInfoContacData = data[0].contact_data;
                                                                const infoDataContact = primeraInfoContacData.email

                                                                n.value = data[0].book_ref
                                                                nt.value = data[0].ticket_no
                                                                idP.value = data[0].passenger_id
                                                                nm.value = data[0].passenger_name
                                                                emP.value = data[0].infoDataContact
                                                            })
                                                    }
                                                })
                                            });
                                        </script>
                                        <script>

                                            document.getElementById('tt').addEventListener('scroll', function (e) {
                                                // 
                                            });
                                        </script>
                                    </div>
                                    <!-- [ Main Content ] end -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
    </section>


    <!-- Required Js -->
    <script src="./template_files/vendor-all.min.js.descarga"></script>
    <script src="./template_files/bootstrap.min.js.descarga"></script>
    <script src="./template_files/pcoded.min.js.descarga"></script>




</body>

</html>